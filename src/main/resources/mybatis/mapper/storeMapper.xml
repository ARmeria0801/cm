<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="storeMapper">
	<!-- <select id="storeReviewList" resultType="ReviewVO">
		
	</select> -->
	
	<sql id="cateKind">
		<choose>
			<when test='cate_kind == "l"'>
				where lcate_code=#{cate_code} and
			</when>
			<when test='cate_kind == "m"'>
				where mcate_code=#{cate_code} and
			</when>
			<when test='cate_kind == "s"'>
				where scate_code=#{cate_code} and
			</when>
			<otherwise>
				where
			</otherwise>
		</choose>
	</sql>

	<resultMap type="GoodsVO" id="Select">
		<id column="gds_num" property="gds_num"/>
		<result column="lcate_code" property="lcate_code"/>
		<result column="mcate_code" property="mcate_code"/>
		<result column="scate_code" property="scate_code"/>
		<result column="gds_seller" property="gds_seller"/>
		<result column="gds_name" property="gds_name"/>
		<result column="gds_price" property="gds_price"/>
		<result column="gds_detail" property="gds_detail"/>
		<result column="gds_option" property="gds_option"/>
		<result column="gds_count" property="gds_count"/>
		<result column="gds_thumbnail" property="gds_thumbnail"/>
		<result column="gds_date" property="gds_date"/>
		<result column="deltem_num" property="deltem_num"/>
		<result column="gds_good" property="gds_good"/>
		<result column="gds_readcount" property="gds_readcount"/>
		<result column="gds_sellcount" property="gds_sellcount"/>
		<result column="gds_ears" property="gds_ears"/>
		<result column="gds_viewyn" property="gds_viewyn"/>
		<result column="gds_delyn" property="gds_delyn"/>
		<association property="deliveryTemplateVO" javaType="DeliveryTemplateVO">
			<id column="deltem_num" property="deltem_num"/>
			<result column="del_name" property="del_name"/>
			<result column="deltem_delfee" property="deltem_delfee"/>
			<result column="deltem_freedel" property="deltem_freedel"/>
		</association>
		<collection property="optionVO" javaType="List" ofType="OptionVO">
			<id column="opt_num" property="opt_num"/>
			<result column="opt_1stname" property="opt_1stname"/>
			<result column="opt_1stval" property="opt_1stval"/>
			<result column="opt_2ndname" property="opt_2ndname"/>
			<result column="opt_2ndval" property="opt_2ndval"/>
			<result column="opt_count" property="opt_count"/>
		</collection>
	</resultMap>

	<select id="storeList" resultType="GoodsVO" parameterType="Pager">
		select gds_num, lcate_code, mcate_code, scate_code, gds_name, gds_price, gds_thumbnail, gds_viewyn
		from goods
		<include refid="cateKind"></include> gds_viewyn='y'
		order by gds_num desc
		LIMIT #{startRow}, #{perPage}
	</select>
	
	<select id="storeCount" resultType="Integer">
		select count(gds_num) from goods
		where gds_viewyn='y'
	</select>
	
	<select id="storeSelect" resultMap="Select" parameterType="GoodsVO">
		select G.*, DT.del_name, DT.deltem_delfee, DT.deltem_freedel, O.opt_num, O.opt_1stname, O.opt_1stval, O.opt_2ndval
		from Goods G
        left outer join DeliveryTemplate DT
        on G.deltem_num = DT.deltem_num
        left outer join project.Option O
        on G.gds_num = O.gds_num
		where G.gds_num = #{gds_num}
        group by O.opt_1stval
	</select>
	
	<select id="option2Select" resultType="OptionVO" parameterType="OptionVO">
		select * from project.option
		where gds_num = #{gds_num} and opt_1stval = #{opt_1stval}
	</select>
</mapper>